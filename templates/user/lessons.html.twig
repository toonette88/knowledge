{% extends 'profile_base.html.twig' %}

{% block title %}Mes Leçons Achetées{% endblock %}

{% block profile_content %}
<div class="container py-5">
    <h3 class="mb-4">Mes Leçons Achetées</h3>

    {% if lessons is not empty %}
        <table class="table table-striped table-hover">
            <thead style="background-color: #0074c7; color: white;">
                <tr>
                    <th>Titre</th>
                    <th>Cursus</th>
                    <th>Catégorie</th>
                    <th>Progression</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for lesson in lessons %}
                    {% if is_granted('view_lesson', lesson) %}
                        <tr>
                            <td>{{ lesson.title }}</td>
                            <td>{{ lesson.course ? lesson.course.title : 'Non défini' }}</td>
                            <td>{{ lesson.course and lesson.course.category ? lesson.course.category.name : 'Non défini' }}</td>
                            <td style="width: 200px;">
                                {% set progression = lessonProgressions[lesson.id] ?? 0 %}
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: {{ progression }}%;" 
                                        aria-valuenow="{{ progression }}" aria-valuemin="0" aria-valuemax="100">
                                    </div>
                                </div>
                                <small>{{ progression }}%</small>
                            </td>
                            <td>
                                <a href="{{ path('user_lesson_show', {'id': lesson.id}) }}" class="btn btn-info btn-sm">
                                    <i class="fas fa-eye"></i> Voir
                                </a>
                            </td>
                        </tr>
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center">Vous n'avez pas accès à cette leçon.</td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-center">Vous n'avez pas encore acheté de leçons.</p>
    {% endif %}
</div>
{% endblock %}
